<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.springboot.mapper.ChartsMapper">

  <!-- 查询借阅和归还数量 -->
  <select id="getCountByTimeRange" resultType="com.example.springboot.mapper.po.BorrowReturnCountPo">
    select count(id) as count, DATE_FORMAT(createtime, '%Y-%m-%d') as date from
    <if test="type == 1">
        borrow
    </if>
    <if test="type == 2">
        `return`
    </if>
    where
    <choose>
        <when test="timeRange == 'week'">
            createtime >= DATE_SUB(NOW(), INTERVAL 1 WEEK)
        </when>
        <when test="timeRange == 'month'">
            createtime >= DATE_SUB(NOW(), INTERVAL 1 MONTH)
        </when>
        <when test="timeRange == 'month2'">
            createtime >= DATE_SUB(NOW(), INTERVAL 2 MONTH)
        </when>
        <when test="timeRange == 'month3'">
            createtime >= DATE_SUB(NOW(), INTERVAL 3 MONTH)
        </when>
        <otherwise>
            createtime > NOW()
        </otherwise>
    </choose>
    group by date
  </select>
</mapper>
